# 金小村数据库表创建和数据导入

本项目用于将Excel表格数据导入到MySQL数据库中。

## 文件说明

### Excel文件
- `客户原始兑付明细2.xlsx` - 客户兑付明细数据
- `仲景宛西.xlsx` - 仲景宛西数据
- `活动方案.xlsx` - 活动方案数据
- `输出结果.xlsx` - 输出结果数据

### 脚本文件
- `analyze_excel.py` - 分析Excel文件结构
- `create_tables.sql` - 数据库表创建SQL语句
- `import_data.py` - 数据导入脚本

## 使用步骤

### 1. 环境准备

确保已安装以下Python包：
```bash
pip install pandas openpyxl mysql-connector-python
```

### 2. 数据库配置

在运行脚本之前，请确保：
- MySQL服务已启动
- 修改 `import_data.py` 中的数据库连接信息：
  - host: 数据库主机地址
  - user: 数据库用户名
  - password: 数据库密码

### 3. 分析Excel文件结构

运行分析脚本查看Excel文件结构：
```bash
python analyze_excel.py
```

### 4. 创建数据库表

手动执行SQL文件或使用导入脚本：
```bash
python import_data.py
```

## 数据库表结构

### 1. customer_redemption_details (客户原始兑付明细表)
- 包含客户兑付相关的详细信息
- 主要字段：结算金额、业务日期、客户编码、商品名称等

### 2. customer_flow (仲景宛西-客户流向表)
- 记录客户间的商品流向
- 主要字段：进货日期、流入方、流出方、物料信息等

### 3. activity_plan (活动方案表)
- 存储活动方案信息
- 主要字段：活动时间、产品名称、活动政策等

### 4. output_results (输出结果表)
- 存储处理后的结果数据
- 主要字段：进货日期、销售信息、活动政策等

## 注意事项

1. 确保Excel文件编码为UTF-8
2. 数据库连接信息需要根据实际情况修改
3. 如果表已存在，需要先删除或使用不同的表名
4. 活动方案表的结构比较特殊，可能需要手动调整

## 故障排除

### 常见问题

1. **数据库连接失败**
   - 检查MySQL服务是否启动
   - 确认用户名和密码是否正确
   - 检查数据库是否存在

2. **编码问题**
   - 确保Excel文件使用UTF-8编码
   - 检查数据库字符集设置

3. **数据类型不匹配**
   - 检查Excel文件中的数据类型
   - 可能需要手动调整SQL表结构

## 联系信息

如有问题，请联系开发团队。 


## 怎么打包：

方案一：打包为可执行文件（推荐，适合Windows用户）
1. **使用 PyInstaller 打包**
   这样用户无需安装Python环境，直接双击运行。
   步骤：
   1.**安装 PyInstaller**
  -  pip install pyinstaller
2.**在项目目录下执行打包命令**
 -   pyinstaller -F -w web_import.py
 -   -F 生成单一可执行文件
 -   -w 不弹出命令行窗口（如需调试可去掉）
 -   pyinstaller --add-data "static;static"   --add-data "uploads;uploads" --hidden-import pandas --hidden-import openpyxl --hidden-import xlrd --onefile web_import.py

3.**打包后目录说明**

- dist/web_import.exe 就是可分发的主程序
- 需要把 static 文件夹、uploads 文件夹、Excel模板等一并打包给对方

4.注意事项
- 数据库配置（如 database_config.py）要一并提供，并指导用户填写自己的MySQL信息
- 依赖的DLL、图片、静态文件等都要放在同级目录或子目录


# Excel数据导入系统 使用说明

## 1. 环境要求
- Windows 10/11
- 已安装MySQL数据库
- （如未打包为exe）需安装Python 3.8+

## 2. 安装步骤
1. 解压本压缩包
2. （如未打包为exe）双击 install.bat 安装依赖
3. 配置 database_config.py，填写你的MySQL信息

## 3. 启动方法
- 双击 web_import.exe
- 或命令行输入 python web_import.py

## 4. 使用方法
- 浏览器访问 http://localhost:5000
- 上传Excel文件，自动导入数据库

## 5. 常见问题
- 端口被占用：请关闭其他占用5000端口的程序
- 数据库连接失败：请检查MySQL配置


## 前端表单控件与交互规范

### 1. 输入框（Input）
- **样式**：圆角、阴影、统一字体，宽度适中（如 240px），高度适中，背景色柔和。
- **交互**：
  - 输入内容自动去除首尾空格，防止因粘贴空格导致搜索不到。
  - 右侧带“清空”按钮（×），点击可一键清空并自动聚焦输入框。
  - 输入框与按钮（如“搜索”、“新增”）同一行，整体紧凑美观。

### 2. 下拉框（Select，多选/单选）
- **样式**：使用 [Choices.js](https://github.com/Choices-js/Choices) 美化，带圆角、阴影、统一字体，宽度与输入框一致。
- **功能**：
  - 支持多选/单选，带 checkbox，支持搜索、可清除。
  - 选项内容动态从后端获取，切换表时自动刷新可选项。
  - 禁止无效选项（如无可选字段时显示“无可选字段”）。
- **交互**：
  - 选项 hover 高亮，选中项可一键清除。
  - 多个下拉框（如“选择字段”、“排序字段”、“排序方向”）风格统一。
  - “排序方向”下拉框与“排序字段”联动，只显示已选字段的升/降序选项，同字段只允许一个方向。

### 3. 排序
- **排序字段**：多选下拉框，支持选择多个排序字段。
- **排序方向**：与排序字段联动，每个字段只能选一个方向（升序/降序）。
- **交互**：选择排序字段后，排序方向自动刷新，避免重复选择。

### 4. 数据表格
- **样式**：斑马线、悬浮高亮、圆角、阴影、统一字体，表头背景色区分。
- **序号**：第一列为“序号”，自动递增。
- **主键/ID**：表格中隐藏，编辑/删除时可用。
- **操作按钮**：如“编辑”、“删除”按钮风格统一，悬浮高亮。

### 5. 分页
- **样式**：分页按钮居中，当前页高亮，按钮圆角，风格与整体统一。
- **交互**：点击分页自动刷新数据，保持滚动条位置。

### 6. 弹窗表单
- **样式**：圆角、阴影、居中，背景色柔和。
- **表单控件**：自动识别日期/时间字段，使用日期控件，数字字段自动格式化。
- **主键只读**，操作成功后自动刷新表格。

### 7. 统一风格
- 所有控件风格现代、统一，交互友好，便于集成和维护。
- 代码片段和样式可直接复用。

> **后续如有新增控件或交互，均应参考本规范进行设计与实现。**